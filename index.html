<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AquaClim Prestige - Devis & Factures</title>

  <!-- Styles -->
  <link rel="stylesheet" href="style.css" />

  <!-- Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <div class="container">
    <!-- En-t√™te -->
    <header class="header">
      <div class="header-inner">
        <img src="logo.png" alt="AquaClim Prestige" class="header-logo" />
        <div>
          <h1>AquaClim Prestige</h1>
          <p class="subtitle">Entretien & D√©pannage - Climatisation & Piscine</p>
          <p class="contact">
            Le Blevennec Lo√Øc ‚Äì 2 avenue Cauvin, 06100 Nice<br />
            T√©l : 06 03 53 77 73 ‚Äì Email : aquaclimprestige@gmail.com<br />
            SIRET : <strong>XXXXXXXXXXXXX</strong>
          </p>
        </div>
      </div>
    </header>

    <!-- Onglets -->
    <div class="top-nav no-print">
      <button
        id="tabDevis"
        class="btn tab-btn active"
        type="button"
        onclick="switchListType('devis')"
      >
        üìÑ Devis
      </button>
      <button
        id="tabFactures"
        class="btn tab-btn"
        type="button"
        onclick="switchListType('facture')"
      >
        üí∞ Factures
      </button>
    </div>

    <!-- VUE LISTE -->
    <section id="listView">
      <div class="actions no-print">
        <button
          id="createDevis"
          class="btn btn-primary"
          type="button"
          onclick="newDocument('devis')"
        >
          ‚ûï Nouveau devis
        </button>

        <button
          id="createFacture"
          class="btn btn-success"
          type="button"
          onclick="newDocument('facture')"
        >
          ‚ûï Nouvelle facture
        </button>

        <!-- Bouton tarifs (liste) -->
        <button
          class="btn btn-devis tarifs-button"
          type="button"
          onclick="openTarifsPanel()"
        >
          üìã Tarifs prestations
        </button>
      </div>

    <!-- Panel Tarifs -->
<div
  id="tarifsPanel"
  class="card no-print hidden"
>
  <h2>Tarifs des prestations</h2>

  <!-- Boutons TOP -->
  <div class="tarifs-actions tarifs-actions-top">
    <button
      class="btn btn-primary"
      type="button"
      onclick="saveTarifsFromUI()"
    >
      üíæ Enregistrer les tarifs
    </button>

    <button
      class="btn btn-secondary"
      type="button"
      onclick="closeTarifsPanel()"
    >
      ‚Üê Retour
    </button>

<button
  class="btn btn-primary btn-small"
  type="button"
  onclick="openTemplateModal()"
>
  ‚ûï Ajouter une prestation
</button>


    <button
      class="btn btn-danger"
      type="button"
      onclick="resetTarifs()"
    >
      R√©initialiser
    </button>
  </div>

  <p class="tarifs-intro">
    Modifie ici les prix HT par d√©faut utilis√©s quand tu choisis un mod√®le.
    Tu peux aussi personnaliser le texte d√©taill√© (Particulier / Syndic).
  </p>

  <table class="documents-table">
    <thead>
      <tr>
        <th>Prestation</th>
        <th>Prix Particulier</th>
        <th>Prix Syndic / Agence</th>
        <th style="width:70px;">Actions</th>
      </tr>
    </thead>
    <tbody id="tarifsTableBody"></tbody>
  </table>

  <!-- Boutons BOTTOM (m√™mes actions) -->
  <div class="tarifs-actions tarifs-actions-bottom">
    <button
      class="btn btn-primary"
      type="button"
      onclick="saveTarifsFromUI()"
    >
      üíæ Enregistrer les tarifs
    </button>

    <button
      class="btn btn-secondary"
      type="button"
      onclick="closeTarifsPanel()"
    >
      ‚Üê Retour
    </button>

 <button
  class="btn btn-primary btn-small"
  type="button"
  onclick="openTemplateModal()"
>
  ‚ûï Ajouter une prestation
</button>


    <button
      class="btn btn-danger"
      type="button"
      onclick="resetTarifs()"
    >
      R√©initialiser
    </button>
  </div>
</div>


      <!-- Tableau documents -->
      <div class="card">
        <div class="filters-row no-print">
          <span id="listTitle" class="list-title">Liste des devis</span>

          <div id="yearFilterContainer" class="hidden">
            <label for="yearFilter" class="filter-label">Ann√©e factures</label>
            <select id="yearFilter" onchange="loadDocumentsList()">
              <option value="all">Toutes</option>
            </select>
          </div>

          <div id="exportContainer" class="hidden">
            <button
              class="btn btn-secondary btn-small"
              type="button"
              onclick="exportFacturesCSV()"
            >
              üì• Exporter factures (CSV)
            </button>
          </div>
        </div>

        <table class="documents-table">
          <thead>
            <tr>
              <th>Type</th>
              <th>Num√©ro</th>
              <th>Client</th>
              <th>Date</th>
              <th>Montant</th>
              <th>Statut</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="documentsTableBody">
            <tr>
              <td colspan="7" class="no-docs-cell">
                Aucun document pour le moment
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- VUE FORMULAIRE -->
    <section id="formView" class="hidden">
      <!-- Actions haut -->
      <div class="actions no-print">
        <button
          class="btn btn-secondary"
          type="button"
          onclick="backToList()"
        >
          ‚Üê Retour
        </button>

        <!-- Boutons li√©s au document -->
        <button
          class="btn action-button"
          type="button"
          onclick="saveDocument()"
        >
          üíæ Enregistrer
        </button>

        <button
          class="btn action-button"
          type="button"
          onclick="openPrintable()"
        >
          üñ®Ô∏è Imprimer / PDF
         </button>

  <button
    class="btn action-button"
    type="button"
    onclick="duplicateCurrent()"
  >
    üßæ Dupliquer
  </button>

        <!-- Bouton tarifs (formulaire) -->

        <button
          id="transformButton"
          class="btn action-button"
          type="button"
          onclick="transformToInvoice()"
          style="display: none;"
        >
          üîÅ Transformer en facture
        </button>

        <button
          class="btn btn-danger"
          type="button"
          onclick="deleteCurrent()"
        >
          üóëÔ∏è Supprimer
        </button>
      </div>

      <div class="card">
        <h2 id="formTitle">Nouveau document</h2>

        <!-- Type / num√©ro / dates -->
        <div class="row">
          <div class="form-group">
            <label>Type de document *</label>
            <select
              id="docType"
              onchange="updateDocType(); updateTransformButtonVisibility();"
            >
              <option value="devis">Devis</option>
              <option value="facture">Facture</option>
            </select>
          </div>

          <div class="form-group">
            <label>Num√©ro</label>
            <input type="text" id="docNumber" readonly />
          </div>

          <div class="form-group">
            <label>Date du document</label>
            <input
              type="date"
              id="docDate"
              onchange="onDocDateChange()"
            />
          </div>

          <div class="form-group" id="validityDateGroup">
            <label>Valable jusqu'au</label>
            <input
              type="date"
              id="validityDate"
              onchange="onValidityChange()"
            />
            <div
              id="devisStatusInfo"
              class="devis-status-info"
            ></div>
          </div>
        </div>

        <!-- Objet -->
        <div class="form-group">
          <label>Objet du devis / de la facture *</label>
          <input
            type="text"
            id="docSubject"
            required
            placeholder="Ex : Entretien piscine + clim ‚Äì Villa Martin"
          />
        </div>

   <!-- Type client -->
<div class="form-group">
  <label>Type de client *</label>
  <div class="client-type-row">

    <label class="client-type-option">
      <input
        type="radio"
        name="clientType"
        id="clientParticulier"
        value="particulier"
        onchange="selectClientType('particulier')"
      />
      Particulier
    </label>

    <label class="client-type-option">
      <input
        type="radio"
        name="clientType"
        id="clientSyndic"
        value="syndic"
        onchange="selectClientType('syndic')"
      />
      Syndic / Agence
    </label>

  </div>
</div>

<!-- Infos client -->
<h3 class="section-title">Informations client</h3>
<div class="row">
  <div class="form-group">
    <label>Nom ou Soci√©t√© *</label>
    <input type="text" id="clientName" required />
  </div>
  <div class="form-group">
    <label>Adresse *</label>
    <input type="text" id="clientAddress" required />
  </div>
  <div class="form-group">
    <label>T√©l√©phone</label>
    <input type="tel" id="clientPhone" />
  </div>
  <div class="form-group">
    <label>Email</label>
    <input type="email" id="clientEmail" />
  </div>
</div>

<!-- Lieu d‚Äôintervention (visible uniquement si SYNDIC) -->
<div id="siteBlock" class="row" style="display:none;">
  <div class="form-group">
    <label>Nom du client sur site *</label>
    <input
      type="text"
      id="siteName"
      placeholder="Ex : Mme Dupont √âlise"
    />
  </div>

  <div class="form-group">
    <label>Adresse du lieu d‚Äôintervention *</label>
    <input
      type="text"
      id="siteAddress"
      placeholder="Ex : R√©sidence Le Parc, B√¢t A, 14 rue de la Libert√©, 06000 Nice"
    />
  </div>
</div>


        <!-- Prestations -->
        <div class="prestations-section">
          <h3 class="section-title">Prestations</h3>
          <div id="prestationsContainer"></div>

          <button
            id="addPrestationBtn"
            class="btn action-button no-print"
            type="button"
            onclick="addPrestation()"
          >
            ‚ûï Ajouter une prestation
          </button>
        </div>

        <!-- Totaux / TVA / R√©duction -->
     <div class="totals">
  <div class="total-line">
    <span>Sous-total HT :</span>
    <span id="subtotalHT">0,00 ‚Ç¨</span>
  </div>

  <!-- R√©duction + TVA c√¥te √† c√¥te -->
  <div class="totals-grid">
    <div class="form-group discount-group">
      <label>R√©duction</label>
      <div class="discount-row">
        <label class="discount-toggle">
          <input
            type="checkbox"
            id="discountEnabled"
            onchange="onDiscountToggle()"
          />
          Appliquer une r√©duction
        </label>
        <input
          type="number"
          id="discountPercentInput"
          value="0"
          min="0"
          max="100"
          step="0.01"
          oninput="onDiscountPercentChange()"
          disabled
        />
        <span class="discount-percent-symbol">%</span>
      </div>
    </div>

    <div class="form-group tva-group">
      <label>TVA</label>
      <div class="tva-options">
        <label>
          <input
            type="radio"
            name="tvaRadio"
            id="tva0"
            onchange="setTVA(0)"
            checked
          />
          0 %
        </label>
        <label>
          <input
            type="radio"
            name="tvaRadio"
            id="tva20"
            onchange="setTVA(20)"
          />
          20 %
        </label>
      </div>
  <div class="tva-rate-wrapper">
  <input
    type="number"
    id="tvaRate"
    value="0"
    step="0.01"
    readonly
  />
  <span class="tva-percent-symbol">%</span>
</div>

  </div>

  <div
    class="total-line"
    id="discountLine"
    style="display: none;"
  >
    <span id="discountLabel">R√©duction :</span>
    <span id="discountAmount">0,00 ‚Ç¨</span>
  </div>

  <div class="total-line">
    <span>TVA :</span>
    <span id="tvaAmount">0,00 ‚Ç¨</span>
  </div>

  <div class="total-line grand-total">
    <span id="totalLabel">NET √Ä PAYER :</span>
    <span id="totalTTC">0,00 ‚Ç¨</span>
  </div>

  <div class="tva-note" id="tvaNote">
    TVA non applicable, article 293 B du CGI.
  </div>
</div>


        <!-- Paiement (factures) -->
        <div
          class="form-group no-print"
          id="paymentSection"
        >
          <label>R√®glement</label>
          <div class="pay-line">
            <label>
              <input
                type="radio"
                name="payMode"
                value=""
                id="payNone"
                onchange="onPayModeChange()"
                checked
              />
              Facture non r√©gl√©e
            </label>
          </div>
          <div class="pay-line">
            <label>
              <input
                type="radio"
                name="payMode"
                value="especes"
                id="payEspeces"
                onchange="onPayModeChange()"
              />
              Esp√®ces
            </label>
            <label>
              <input
                type="radio"
                name="payMode"
                value="cb"
                id="payCB"
                onchange="onPayModeChange()"
              />
              Carte bancaire
            </label>
            <label>
              <input
                type="radio"
                name="payMode"
                value="virement"
                id="payVirement"
                onchange="onPayModeChange()"
              />
              Virement
            </label>
            <label>
              <input
                type="radio"
                name="payMode"
                value="cheque"
                id="payCheque"
                onchange="onPayModeChange()"
              />
              Ch√®que
            </label>
          </div>
          <div
            id="paymentDateWrapper"
            class="payment-date-wrapper"
          >
            <label>Date de r√®glement</label>
            <input type="date" id="paymentDate" />
          </div>
        </div>

        <!-- Notes -->
        <div class="form-group">
          <label>Notes / Conditions</label>
          <textarea
            id="notes"
            placeholder="Conditions de paiement, garanties, notes diverses..."
          ></textarea>
        </div>

        <!-- Actions bas -->
        <div class="form-actions no-print">
          <button
            class="btn action-button"
            type="button"
            onclick="saveDocument()"
          >
            üíæ Enregistrer
          </button>
          <button
            class="btn action-button"
            type="button"
            onclick="openPrintable()"
          >
            üñ®Ô∏è Imprimer / PDF
          </button>
          <button
            class="btn btn-secondary"
            type="button"
            onclick="backToList()"
          >
            ‚Üê Retour
          </button>
        </div>
      </div>
    </section>
  </div>
<!-- ================= MODAL AJOUT PRESTATION ================= -->
<div id="templateModal" class="confirm-overlay hidden">
  <div class="confirm-box info">
    <div class="confirm-icon info">üßæ</div>
    <h3 class="confirm-title">Nouvelle prestation</h3>

    <div class="form-group">
      <label>Nom de la prestation *</label>
      <input
        type="text"
        id="tplName"
        placeholder="Ex : Entretien pompe piscine"
      />
    </div>

    <div class="form-group">
      <label>Prix HT Particulier *</label>
      <input
        type="number"
        id="tplPart"
        step="0.01"
        min="0"
        oninput="onTplPartChange()"
        placeholder="Ex : 120"
      />
    </div>

    <div class="form-group">
      <label>Prix HT Syndic / Agence</label>
      <input
        type="number"
        id="tplSyn"
        step="0.01"
        min="0"
        placeholder="Calcul√© automatiquement"
      />
    </div>

    <div class="confirm-buttons">
      <button
        type="button"
        class="btn btn-secondary"
        onclick="closeTemplateModal()"
      >
        Annuler
      </button>
      <button
        type="button"
        class="btn btn-primary"
        onclick="validateTemplateModal()"
      >
        ‚úÖ Cr√©er
      </button>
    </div>
  </div>
</div>
<!-- ========================================================= -->

<!-- ================= POPUP CONFIRM CUSTOM ================= -->
<div id="confirmOverlay" class="confirm-overlay hidden">
  <div class="confirm-box">
    <div class="confirm-icon" id="confirmIcon">‚ö†Ô∏è</div>
    <h3 class="confirm-title" id="confirmTitle"></h3>
    <p class="confirm-message" id="confirmMessage"></p>
    <div class="confirm-buttons">
      <button id="confirmCancel" class="btn btn-secondary" type="button">Annuler</button>
      <button id="confirmOk" class="btn btn-danger" type="button">OK</button>
    </div>
  </div>
</div>
<!-- App JS -->
<script src="app.js"></script>
</body>
</html>












